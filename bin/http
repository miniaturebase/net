#!/usr/bin/env php
<?php

declare(strict_types = 1);

require_once __DIR__ . '/../vendor/autoload.php';

use Laminas\Diactoros\Request;
use Laminas\Diactoros\Response\JsonResponse;
use Laminas\Diactoros\Stream;
use Laminas\Diactoros\Uri;
use Minibase\Net\Http;
use Psr\Http\Message\RequestInterface;
use Psr\Http\Message\ResponseInterface;

$http = new Http(
    static fn (): RequestInterface => new Request(),
    static fn (...$args): ResponseInterface => new JsonResponse(...$args),
);

# $api = new Uri('https://jsonplaceholder.typicode.com');
# $response = $http->get($api->withPath('posts')->withQuery('?_limit=1'));
# dump(Http::OK === $response->getStatusCode());

$api = new Uri('http://localhost:3000');
$response = $http->post($api, 'application/json', '{"foo": "bar"}');

dump(json_decode(json_decode($response->getBody()->getContents())));
